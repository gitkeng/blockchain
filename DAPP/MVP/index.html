<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="web3.min.js"></script>
        <script type="text/javascript">
            var tokenAddr =         '';
            var mainContractAddr =  '';
        </script>
        <script type="text/javascript">
          window.addEventListener('load', function() {

              // Checking if Web3 has been injected by the browser (Mist/MetaMask)
              if (typeof web3 !== 'undefined') {
                // Use Mist/MetaMask's provider
                web3js = new Web3(web3.currentProvider);

              } else {
                console.log('No web3? You should consider trying MetaMask!')
                // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
                web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/8kkr6X3gKuB8cURFQsfa"));
              }
            
              // Now you can start your app & access web3 freely:
              startApp();
            })
        
            
            // Get current network
            function startApp() {
                web3.version.getNetwork((err, netId) => {
                    var network = "";
                  switch (netId) {
                    case "1":
                        network = 'Mainnet';
                      break
                    case "2":
                        network = 'Deprecated Morden';
                      break
                    case "3":
                        network = 'Ropsten';
                        tokenAddr =         '0x95477082106ad76ec820a5e6bf8e35055003fd21';
                        mainContractAddr =  '0x2ae53961e6cad27ed6ef71c4b1e6021786d7846b';
                      break
                    case "4":
                        network = 'Rinkeby';
                        tokenAddr =         '0x1Fb1670E4Ba34238cF16e5491eE6B2C436b52B38';
                        mainContractAddr =  '0x4512da2ff5481f2bb63b1df9e3d1eb537e9f9225';
                      break
                    case "42":
                        network = 'Kovan';
                      break
                    default:
                        network = 'Unknown';
                  }
                  $("#eth_network").text(network);
                  
                  var account = web3.eth.accounts[0];
                  $("#eth_address").text(account);
                  
                  reloadInfo();
                })
            }
            
            function reloadInfo() {
                // Token
                getKatinOwner();
                getKatinName();
                getKatinSymbol();
                getKatinTotalSupply();
                
                // Wallet
                try { 
                    getBalance();
                    getKatinBalance();
                }
                catch(err) {
                    console.log(err);
                }
                
                
                // Main contract
                getMainContractOwner();
                getMainContractProposalCount( function (count) {
                    $("#main_contract_proposal_count").text(count);
                });
                
                // Proposals
                displayProposals();
            }
            
            // Get block info
            function getBlock() {
                web3.eth.getBlock(48, function(error, result){
                    if(!error) {
                        console.log(JSON.stringify(result));
                        $("#balance").html(JSON.stringify(result));
                    } else {
                        console.error(error);
                    }
                })
            }
            
            // Get Katin owner
            function getKatinOwner() {
                var contract = getTakinToken();
                 contract.owner( function(err,ok) { 
                    console.log(err,ok) ;
                    $("#eth_owner").text(ok);
                } );
            }
            
            // Get account balance
            function getBalance() {
                var account = web3.eth.accounts[0];
  
                    web3.eth.getBalance(account, function(error, result) {
                        if (error) {
                        console.error(error);
                        } else {
                            $("#balance").html(web3.fromWei(result.toNumber()));
                        }
                  }); // getbalance account
            }
            
            // Get Katin balance
            function getKatinBalance() {
                web3.eth.defaultAccount = web3.eth.accounts[0];
                var account = web3.eth.accounts[0];

                var contract = getTakinToken();
                console.log(contract);
                
                web3.eth.getAccounts( (err, ok) => account = ok[0] );
                contract.balanceOf( account, function(err, result) { 
                    console.log(err, result.c[0]) ;
                    
                    $("#Katin_balance").text( web3.fromWei(result.toNumber()) );
                } );
            }
            
            // Get Katin name
            function getKatinName() {
                var contract = getTakinToken();
                 contract.name( function(err,ok) { 
                    console.log(err,ok) ;
                    $("#Katin_name").text(ok);
                } );
            }
            
            // Get Katin symbol
            function getKatinSymbol() {
                var contract = getTakinToken();
                 contract.symbol( function(err,ok) { 
                    console.log(err,ok) ;
                    $("#Katin_symbol").text(ok);
                } );
            }
            
            // Get katin total supply
            function getKatinTotalSupply() {
                var contract = getTakinToken();
                 contract.totalSupply( function(err,result) { 
                    console.log(err, result) ;
                    $("#Katin_total_supply").text( web3.fromWei(result.toNumber()));
                } );
            }
            
            // Mint Km.
            function katinMintKm() {
                var contract = getTakinToken();
                var amount = $("#mint_km_amount").val();
                var addr = $("#mint_km_addr").val();
                
                console.log(amount, addr);
                
                
                 contract.mintKm( addr, amount, function(err,ok) { 
                    console.log(err,ok) ;
                    // $("#Katin_total_supply").text(ok.c[0]);
                } );
            }
            
            // Transfer katin
            function _katinTransfer(amount, addr) {
                var contract = getTakinToken();
                
                console.log(amount, addr);
                contract.transfer( addr, amount, function(err,ok) { 
                    console.log(err,ok) ;
                    // $("#Katin_total_supply").text(ok.c[0]);
                } );
            }
            
            // Transfer katin
            function katinTransfer() {
                var amount = $("#katin_transfer_amount").val();
                var addr = $("#katin_transfer_addr").val();
                _katinTransfer(amount, addr);
            }
            
            // Get katin token contract
            function getTakinToken() {
                var abi = [ { "constant": true, "inputs": [], "name": "mintingFinished", "outputs": [ { "name": "", "type": "bool", "value": false } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "name", "outputs": [ { "name": "", "type": "string", "value": "KTT2" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_spender", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "approve", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "totalSupply", "outputs": [ { "name": "", "type": "uint256", "value": "6.02120000000000000001e+23" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "transferFrom", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "decimals", "outputs": [ { "name": "", "type": "uint8", "value": "18" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_km", "type": "uint256" } ], "name": "mintKm", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_amount", "type": "uint256" } ], "name": "mint", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "who", "type": "address" } ], "name": "balanceOf", "outputs": [ { "name": "balance", "type": "uint256", "value": "0" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [], "name": "finishMinting", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [ { "name": "", "type": "address", "value": "0x02219839ef94a1a857fe943f74d8297d7731a71f" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "symbol", "outputs": [ { "name": "", "type": "string", "value": "KTT2" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "transfer", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" }, { "name": "", "type": "address" } ], "name": "allowance", "outputs": [ { "name": "", "type": "uint256", "value": "0" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "newOwner", "type": "address" } ], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "name": "_name", "type": "string", "index": 0, "typeShort": "string", "bits": "", "displayName": "&thinsp;<span class=\"punctuation\">_</span>&thinsp;name", "template": "elements_input_string", "value": "KTT2" }, { "name": "_symbol", "type": "string", "index": 1, "typeShort": "string", "bits": "", "displayName": "&thinsp;<span class=\"punctuation\">_</span>&thinsp;symbol", "template": "elements_input_string", "value": "KTT2" }, { "name": "_decimals", "type": "uint8", "index": 2, "typeShort": "uint", "bits": "8", "displayName": "&thinsp;<span class=\"punctuation\">_</span>&thinsp;decimals", "template": "elements_input_uint", "value": "18" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "to", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Mint", "type": "event" }, { "anonymous": false, "inputs": [], "name": "MintFinished", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "_owner", "type": "address" }, { "indexed": true, "name": "_spender", "type": "address" }, { "indexed": false, "name": "_value", "type": "uint256" } ], "name": "Approval", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "_from", "type": "address" }, { "indexed": true, "name": "_to", "type": "address" }, { "indexed": true, "name": "_value", "type": "uint256" }, { "indexed": false, "name": "_data", "type": "bytes" } ], "name": "Transfer", "type": "event" } ];
                
                var CoursetroContract = web3.eth.contract(abi);

                var contract = CoursetroContract.at(tokenAddr);
                
                return contract;
            }
        </script>
        
        <!-- Main contract -->
        <script type="text/javascript">
            // Get Main contract
            function getMainContract() {
                var abi = [ { "constant": true, "inputs": [ { "name": "", "type": "uint256" } ], "name": "proposals", "outputs": [ { "name": "", "type": "address", "value": "0x" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_proposal", "type": "address" } ], "name": "acceptProposal", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "_mainContract", "type": "address" }, { "name": "_token", "type": "address" }, { "name": "_goal", "type": "uint256" }, { "name": "_description", "type": "string" }, { "name": "_periodInMinutes", "type": "uint256" }, { "name": "_documentUrl", "type": "string" }, { "name": "_documentHash", "type": "string" } ], "name": "newProposal", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [ { "name": "", "type": "address", "value": "0x02219839ef94a1a857fe943f74d8297d7731a71f" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_index", "type": "uint256" }, { "name": "_documentUrl", "type": "string" }, { "name": "_documentHash", "type": "string" } ], "name": "updateProposalDeliveryFailed", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "proposalCount", "outputs": [ { "name": "", "type": "uint256", "value": "0" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "newOwner", "type": "address" } ], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "_index", "type": "uint256" }, { "name": "_documentUrl", "type": "string" }, { "name": "_documentHash", "type": "string" } ], "name": "updateProposalDeliverySuccess", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "payable": true, "stateMutability": "payable", "type": "fallback" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "_sender", "type": "address" }, { "indexed": false, "name": "_value", "type": "uint256" } ], "name": "EtherReceive", "type": "event" } ];
                
                var CoursetroContract = web3.eth.contract(abi);

                var contract = CoursetroContract.at(mainContractAddr);
                
                return contract;
            }
            
            // Get Main contract name
            function getMainContractOwner() {
                var contract = getMainContract();
                 contract.owner( function(err,ok) { 
                    console.log(err,ok) ;
                    $("#main_contract_owner").text(ok);
                } );
            }
            
            // Get number of proposals
            function getMainContractProposalCount( callback ) {
                var contract = getMainContract();
                 contract.proposalCount( function(err,ok) { 
                    console.log(err,ok.c) ;
                    callback(ok.c[0]);
                } );
            }

            // Accept a propo9sal
            function acceptProposal() {
                var proposalAddr = $("#main_contract_accept_proposal_addr").val();
                
                var contract = getMainContract();
                 contract.acceptProposal(proposalAddr, function(err,ok) { 
                    console.log(err,ok) ;
                } );
            }
            
            // New proposal
            function newProposal() {
                
                var _goal = $("#new_proposal_goal").val();
                var _description = $("#new_proposal_description").val();
                var _periodInMinutes = $("#new_proposal_period_in_minutes").val();
                var _documentUrl = $("#new_proposal_document_url").val();
                var _documentHash = $("#new_proposal_document_hash").val();
                            
                var contract = getMainContract();
                
                contract.newProposal(mainContractAddr, tokenAddr, _goal, _description, _periodInMinutes, _documentUrl, _documentHash, function(err,ok) { 
                    console.log(err,ok) ;
                } );
            }
            
            // Transfer ownership
            function transferOwner() {
                var addr = $("#main_contract_transfer_ownership_addr").val();
                
                var contract = getMainContract();
                 contract.transferOwnership(addr, function(err,ok) { 
                    console.log(err,ok) ;
                } );
            }
            
        </script>
            
            
        
        <!-- Proposal contract -->
        <script type="text/javascript">
            
            
            // Get Proposal description
            function getProposalDescription(addr, callback) {
                var contract = getProposalContract(addr);
                 contract.description( function(err,ok) { 
                    console.log(err,ok);
                    callback(ok);
                } );
            }
            
            // Get Proposal goal
            function getProposalGoal(addr, callback) {
                var contract = getProposalContract(addr);
                 contract.goal( function(err,result) { 
                    console.log(err,result);
                    callback( web3.fromWei(result.toNumber()) );
                } );
            }
            
            // Get Proposal progress
            function getProposalProgress(addr, callback) {
                var contract = getProposalContract(addr);
                 contract.progress( function(err, result) { 
                    console.log(err, result);
                    callback( web3.fromWei(result.toNumber()) );
                } );
            }
            
            // Get Proposal document url
            function getProposalDocumentUrl(addr, callback) {
                var contract = getProposalContract(addr);
                 contract.documentUrl( function(err,ok) { 
                    console.log(err,ok);
                    callback(ok);
                } );
            }
            
            // Get Proposal document hash
            function getProposalDocumentHash(addr, callback) {
                var contract = getProposalContract(addr);
                 contract.documentHash( function(err,ok) { 
                    console.log(err,ok);
                    callback(ok);
                } );
            }
            
            // Get Proposal status
            function getProposalStatus(addr, callback) {
                var contract = getProposalContract(addr);
                 contract.status( function(err,ok) { 
                    console.log(err,ok);
                    if (0 == ok) {
                        callback("Voting");
                    } else if (1 == ok) {
                        callback("Success");
                    } else  if (2 == ok) {
                        callback("Failed");
                    } else {
                        callback("Unknown");
                    }
                    
                } );
            }
            
            // Get Proposal vote
            function getProposalVoter(addr, index, callback) {
                var contract = getProposalContract(addr);
                 contract.votes(index, function(err,ok) { 
                    console.log(err,ok);
                    var voterAddr = ok[0];
                    var amount = ok[1].c[0];
                    callback(voterAddr, amount);
                } );
            }
            
            // Display Proposal voter
            function displayProposalVoter(proposalIndex) {
                var voterIndex = $("#proposal_" + proposalIndex + "_voter_index").val();

                getProposalAddrAtIndex(proposalIndex, function (addr) {
                    getProposalVoter(addr, voterIndex, function (voterAddr, amount) {
                        console.log(voterAddr, amount);
                        
                        $("#proposal_" + proposalIndex + "_voter_index_address").text(voterAddr);
                        $("#proposal_" + proposalIndex + "_voter_index_amount").text(amount);
                    });
                });
            }
            
            // Get Proposal voter from address
            function getProposalVoterAddr(addr, voterAddr, callback) {
                var contract = getProposalContract(addr);
                 contract.voteBy(voterAddr, function(err,ok) { 
                    console.log(err,ok.c[0]);
                    callback(ok.c[0]);
                } );
            }
            
            // Display Proposal voter from address
            function displayProposalVoterAddr(proposalIndex) {
                var voterAddr = $("#proposal_" + proposalIndex + "_voter_addr").val();

                getProposalAddrAtIndex(proposalIndex, function (addr) {
                    getProposalVoterAddr(addr, voterAddr, function (amount) {
                        console.log(amount);
                        
                        $("#proposal_" + proposalIndex + "_voter_addr_amount").text(amount);
                    });
                });
            }
            
            // Get proposal addr
            function getProposalAddrAtIndex(index, callback) {
                var contract = getMainContract();
                contract.proposals(index, function(error, ok) { 
                    console.log(error, ok);
                    callback(ok);
                } );
            }
            
            function displayProposal(index) {
                getProposalAddrAtIndex(index, function (addr) {
                    
                    // Proposal address
                    $("#proposal_" + index + "_addr").text(addr);
                    
                    // Proposal description
                    getProposalDescription(addr, function(description) {
                        $("#proposal_" + index + "_description").text(description);
                    });
                    
                    // Proposal goal
                    getProposalGoal(addr, function(goal) {
                        $("#proposal_" + index + "_goal").text(goal);
                    });
                    
                    // Proposal progress
                    getProposalProgress(addr, function(progress) {
                        $("#proposal_" + index + "_progress").text(progress);
                    });
                    
                    // Proposal document url
                    getProposalDocumentUrl(addr, function(documentUrl) {
                        $("#proposal_" + index + "_document_url").text(documentUrl);
                    });
                    
                    // Proposal document hash
                    getProposalDocumentHash(addr, function(documentHash) {
                        $("#proposal_" + index + "_document_hash").text(documentHash);
                    });
                    
                    
                    // Proposal status
                    getProposalStatus(addr, function(status) {
                        $("#proposal_" + index + "_status").text(status);
                    });
                });
            }
            
            function cloneProposal(index) {
                var a = $("#proposal_copy").clone();
                $(a).find(".proposal_name").text("Proposal " + index);
                $(a).find(".proposal_addr").attr("id", "proposal_" + index + "_addr");
                $(a).find(".proposal_description").attr("id", "proposal_" + index + "_description");
                $(a).find(".proposal_goal").attr("id", "proposal_" + index + "_goal");
                $(a).find(".proposal_progress").attr("id", "proposal_" + index + "_progress");
                $(a).find(".proposal_status").attr("id", "proposal_" + index + "_status");
                $(a).find(".proposal_document_url").attr("id", "proposal_" + index + "_document_url");
                $(a).find(".proposal_document_hash").attr("id", "proposal_" + index + "_document_hash");
                $(a).find(".proposal_vote_amount").attr("id", "proposal_" + index + "_vote_amount");
                $(a).find(".proposal_vote_button").attr("onClick", "javascript:voteForProposal(" + index + ");");
                $(a).find(".proposal_verify_button").attr("onClick", "javascript:verifyProposal(" + index + ");");
                
                $(a).find(".proposal_voter_index").attr("id", "proposal_" + index + "_voter_index");
                $(a).find(".proposal_voter_index_button").attr("onClick", "javascript:displayProposalVoter(" + index + ");");
                $(a).find(".proposal_voter_index_address").attr("id", "proposal_" + index + "_voter_index_address");
                $(a).find(".proposal_voter_index_amount").attr("id", "proposal_" + index + "_voter_index_amount");
                
                $(a).find(".proposal_voter_addr").attr("id", "proposal_" + index + "_voter_addr");
                $(a).find(".proposal_voter_addr_button").attr("onClick", "javascript:displayProposalVoterAddr(" + index + ");");
                $(a).find(".proposal_voter_addr_amount").attr("id", "proposal_" + index + "_voter_addr_amount");
                        
                $(a).appendTo("#more_proposals");
            }
            
            // Show proposals information
            function displayProposals() {
                getMainContractProposalCount( function (count) {
                    for (var i = 0; i < count; i++) {
                        cloneProposal(i);
                        displayProposal(i);
                    }
                });
            }
            
            // Vote proposal
            function voteForProposal(index) {
                var amount = $("#proposal_" + index + "_vote_amount").val();
                
                getProposalAddrAtIndex(index, function (addr) {
                    _katinTransfer(amount, addr);
                });
            }
            
            // Verify Proposal
            function verifyProposal(index) {
                getProposalAddrAtIndex(index, function (addr) {
                    var contract = getProposalContract(addr);
                     contract.verify(function(err,ok) { 
                        console.log(err,ok);
                    } );
                });
            }
            
            // Get Proposal contract
            function getProposalContract(addr) {
                var abi = [{"constant":true,"inputs":[],"name":"votingDeadline","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"deliveryStatus","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"status","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"documentUrl","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"goal","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"progress","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"votes","outputs":[{"name":"voter","type":"address"},{"name":"amount","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"description","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"periodInMinutes","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"documentHash","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_voter","type":"address"}],"name":"voteBy","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_documentUrl","type":"string"},{"name":"_documentHash","type":"string"},{"name":"_status","type":"uint8"}],"name":"updateDelivery","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"deliveryDocUrl","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_sender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"tokenFallback","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"deliveryDocHash","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"voteCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"mainContract","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"token","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"verify","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"_mainContract","type":"address"},{"name":"_token","type":"address"},{"name":"_goal","type":"uint256"},{"name":"_description","type":"string"},{"name":"_periodInMinutes","type":"uint256"},{"name":"_documentUrl","type":"string"},{"name":"_documentHash","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_sender","type":"address"},{"indexed":false,"name":"_value","type":"uint256"},{"indexed":false,"name":"_extraData","type":"bytes"}],"name":"TokenFallback","type":"event"}];
                
                var CoursetroContract = web3.eth.contract(abi);

                var contract = CoursetroContract.at(addr);
                
                return contract;
            }
            
        </script>
            
            
            
        </script>
    
    <style type="text/css">
        .p_network {
            border: 4px solid;
            border-radius: 10px;
            padding: 10px;
            border-color: #2196F3;
            text-align: center;
            width: 11em;
            margin: auto;
        }
        
        table.info tr {
            line-height: 2em;
        }
        
        table.info .label {
            width: 9em;
        }
    </style>
    </head>
    <body>
        <p class="p_network">
            <span>Network: </span>
            <span id="eth_network"></span>
        </p>
        
        <!-- Token --> 
        <div style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;">Katin Token</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">name:</td><td><span id="Katin_name"></span></td>
                    </tr>
                    <tr>
                        <td class="label">symbol:</td><td><span id="Katin_symbol"></span></td>
                    </tr>
                    <tr>
                        <td class="label">owner:</td><td><span id="eth_owner"></span></td>
                    </tr>
                    <tr>
                        <td class="label">Total supply:</td><td><span id="Katin_total_supply"></span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        
        <!-- Wallet --> 
        <div style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;">Wallet</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">account:</td><td><span id="eth_address"></span></td>
                    </tr>
                    <tr>
                        <td class="label">ether:</td><td><span id="balance"></span></td>
                    </tr>
                    <tr>
                        <td class="label">Katin token:</td><td><span id="Katin_balance"></span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="clear:both;">
            
        </div>
        
        
        <!-- Mint km --> 
        <div style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;">Mint km</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">
                            <input type="text" name="mint_km_amount" id="mint_km_amount" placeholder="km."/>
                            <input type="text" name="mint_km_addr" id="mint_km_addr" placeholder="address"/>
                            <input type="button" value="Mint" name="Mint km." onClick="javascript:katinMintKm();" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Transfer Katin --> 
        <div style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;">Transfer katin</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">
                            <input type="text" name="katin_transfer_amount" id="katin_transfer_amount" placeholder="amount"/>
                            <input type="text" name="katin_transfer_addr" id="katin_transfer_addr" placeholder="address"/>
                            <input type="button" value="Transfer katin" name="Transfer katin" onClick="javascript:katinTransfer();" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="clear:both;">
            
        </div>
        
        <!-- Main contract --> 
        <div style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;">Main contract</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">owner:</td><td><span id="main_contract_owner"></span></td>
                    </tr>
                    <tr>
                        <td class="label">proposals:</td><td><span id="main_contract_proposal_count"></span></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="main_contract_accept_proposal_addr" placeholder="proposal address"/></td>
                        <td class="label"><input type="button" value="Accept" name="Accept" onClick="javascript:acceptProposal();" /></td>
                    </tr>
                    <tr>
                        <td><input type="text" id="main_contract_transfer_ownership_addr" placeholder="Transfer ownership"/></td>
                        <td class="label"><input type="button" value="Transfer" name="Transfer" onClick="javascript:transferOwner();" /></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- New Proposal --> 
        <div style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;">New Proposal</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">
                            <input type="text" name="new_proposal_goal" id="new_proposal_goal" placeholder="goal"/>
                            <input type="text" name="new_proposal_description" id="new_proposal_description" placeholder="description"/>
                            <input type="text" name="new_proposal_period_in_minutes" id="new_proposal_period_in_minutes" placeholder="Period in minutes"/>
                            <input type="text" name="new_proposal_document_url" id="new_proposal_document_url" placeholder="Document url"/>
                            <input type="text" name="new_proposal_document_hash" id="new_proposal_document_hash" placeholder="Document hash"/>
                            <input type="button" value="Create" name="Create" onClick="javascript:newProposal();" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="clear:both;">
            
        </div>
        
        <!-- Proposal copy --> 
        <div style="display:none;">
            <div id="proposal_copy" style="border: 1px solid;padding: 1em;border-radius: 1em;margin: 2em;float: left;">
            <span style="text-align: center;display: block;" class="proposal_name">Proposal copy</span>
            <table class="info">
                <tbody>
                    <tr>
                        <td class="label">address:</td><td><span class="proposal_addr"></span></td>
                    </tr>
                    <tr>
                        <td class="label">description:</td><td><span class="proposal_description"></span></td>
                    </tr>
                    <tr>
                        <td class="label">goal:</td><td><span class="proposal_goal"></span></td>
                    </tr>
                    <tr>
                        <td class="label">progress:</td><td><span class="proposal_progress"></span></td>
                    </tr>
                    <tr>
                        <td class="label">status:</td><td><span class="proposal_status"></span></td>
                    </tr>
                    <tr>
                        <td class="label">document url:</td><td><span class="proposal_document_url"></span></td>
                    </tr>
                    <tr>
                        <td class="label">document hash:</td><td><span class="proposal_document_hash"></span></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="proposal_vote_amount" placeholder="amount"/></td>
                        <td class="label"><input class="proposal_vote_button" type="button" value="Vote" name="Vote" onClick="javascript:voteForProposal(xx);" /></td>
                    </tr>
                    <tr>
                        <td class="label"><input class="proposal_verify_button" type="button" value="Verify proposal" name="Verify proposal" onClick="javascript:verifyProposal(xx);" /></td>
                    </tr>
                    <tr>
                        <td><span style="color:#ffffff00; line-height: 25px;">empty space</span></td>
                    </tr>
                    <tr>
                        <td><span>Vote history</span></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="proposal_voter_index" placeholder="voter index"/></td>
                        <td class="label"><input class="proposal_voter_index_button" type="button" value="Load" name="Load" onClick="javascript:displayProposalVoter(xx);" /></td>
                    </tr>
                    <tr>
                        <td><span class="proposal_voter_index_address"></span></td>
                        <td><span class="proposal_voter_index_amount"></span></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="proposal_voter_addr" placeholder="voter address"/></td>
                        <td class="label"><input class="proposal_voter_addr_button" type="button" value="Load" name="Load" onClick="javascript:displayProposalVoterAddr(xx);" /></td>
                    </tr>
                    <tr>
                        <td><span class="proposal_voter_addr_amount"></span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>
        
        <div id="more_proposals">
            
        </div>
        
    </body>
</html>